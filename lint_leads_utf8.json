[{"filePath":"d:\\Code\\Next\\next-crm-tailwind-shadcn-app\\app\\dashboard\\leads\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SidebarTrigger' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":24,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"SidebarTrigger"},"fix":{"range":[561,618],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Separator' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":19,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Separator"},"fix":{"range":[620,674],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Breadcrumb' is defined but never used. Allowed unused vars must match /^_/u.","line":19,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Breadcrumb"},"fix":{"range":[688,699],"text":""},"desc":"Remove unused variable \"Breadcrumb\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BreadcrumbItem' is defined but never used. Allowed unused vars must match /^_/u.","line":20,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":17,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"BreadcrumbItem"},"fix":{"range":[698,717],"text":""},"desc":"Remove unused variable \"BreadcrumbItem\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BreadcrumbLink' is defined but never used. Allowed unused vars must match /^_/u.","line":21,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":17,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"BreadcrumbLink"},"fix":{"range":[717,736],"text":""},"desc":"Remove unused variable \"BreadcrumbLink\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BreadcrumbList' is defined but never used. Allowed unused vars must match /^_/u.","line":22,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":17,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"BreadcrumbList"},"fix":{"range":[736,755],"text":""},"desc":"Remove unused variable \"BreadcrumbList\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BreadcrumbPage' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":17,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"BreadcrumbPage"},"fix":{"range":[755,774],"text":""},"desc":"Remove unused variable \"BreadcrumbPage\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BreadcrumbSeparator' is defined but never used. Allowed unused vars must match /^_/u.","line":24,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":22,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"BreadcrumbSeparator"},"fix":{"range":[676,837],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Target' is defined but never used. Allowed unused vars must match /^_/u.","line":29,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Target"},"fix":{"range":[878,889],"text":""},"desc":"Remove unused variable \"Target\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Clock' is defined but never used. Allowed unused vars must match /^_/u.","line":31,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Clock"},"fix":{"range":[899,909],"text":""},"desc":"Remove unused variable \"Clock\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Phone' is defined but never used. Allowed unused vars must match /^_/u.","line":36,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Phone"},"fix":{"range":[959,969],"text":""},"desc":"Remove unused variable \"Phone\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Globe' is defined but never used. Allowed unused vars must match /^_/u.","line":41,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Globe"},"fix":{"range":[1015,1025],"text":""},"desc":"Remove unused variable \"Globe\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Mail' is defined but never used. Allowed unused vars must match /^_/u.","line":42,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Mail"},"fix":{"range":[1025,1034],"text":""},"desc":"Remove unused variable \"Mail\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Facebook' is defined but never used. Allowed unused vars must match /^_/u.","line":43,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Facebook"},"fix":{"range":[1034,1047],"text":""},"desc":"Remove unused variable \"Facebook\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'MessageCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":44,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MessageCircle"},"fix":{"range":[1047,1065],"text":""},"desc":"Remove unused variable \"MessageCircle\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Instagram' is defined but never used. Allowed unused vars must match /^_/u.","line":45,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":12,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Instagram"},"fix":{"range":[1065,1079],"text":""},"desc":"Remove unused variable \"Instagram\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Voicemail' is defined but never used. Allowed unused vars must match /^_/u.","line":46,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":12,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Voicemail"},"fix":{"range":[1079,1093],"text":""},"desc":"Remove unused variable \"Voicemail\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Wrench' is defined but never used. Allowed unused vars must match /^_/u.","line":47,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":47,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Wrench"},"fix":{"range":[1093,1104],"text":""},"desc":"Remove unused variable \"Wrench\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'theme' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":144,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":144,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'color' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":144,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":144,"endColumn":23},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nd:\\Code\\Next\\next-crm-tailwind-shadcn-app\\app\\dashboard\\leads\\page.tsx:196:5\n  194 |   // Prevent hydration mismatch by only rendering after mount\n  195 |   useEffect(() => {\n> 196 |     setMounted(true);\n      |     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  197 |   }, []);\n  198 |   const [hoveredCard, setHoveredCard] = useState<string | null>(null);\n  199 |   const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 });","line":196,"column":5,"nodeType":null,"endLine":196,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'hexToColor' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":202,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":202,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'conversionRate' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":307,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":307,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'totalCallsMade' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":322,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":322,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'avgResponseTime' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":323,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":323,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":381,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":381,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17062,17065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17062,17065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":422,"column":128,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":422,"endColumn":131,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19521,19524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19521,19524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'convertedWidth' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":845,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":845,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'lostWidth' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":846,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":846,"endColumn":36}],"suppressedMessages":[],"errorCount":29,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useMemo } from \"react\";\r\nimport { useTheme } from \"@/app/hooks/useTheme\";\r\nimport Link from \"next/link\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\r\nimport {\r\n  Accordion,\r\n  AccordionContent,\r\n  AccordionItem,\r\n  AccordionTrigger,\r\n} from \"@/components/ui/accordion\";\r\nimport { SidebarTrigger } from \"@/components/ui/sidebar\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport {\r\n  Breadcrumb,\r\n  BreadcrumbItem,\r\n  BreadcrumbLink,\r\n  BreadcrumbList,\r\n  BreadcrumbPage,\r\n  BreadcrumbSeparator,\r\n} from \"@/components/ui/breadcrumb\";\r\nimport {\r\n  TrendingUp,\r\n  TrendingDown,\r\n  Target,\r\n  Users,\r\n  Clock,\r\n  CheckCircle2,\r\n  DollarSign,\r\n  Award,\r\n  Zap,\r\n  Phone,\r\n  Plus,\r\n  Settings2,\r\n  X,\r\n  CalendarIcon,\r\n  Globe,\r\n  Mail,\r\n  Facebook,\r\n  MessageCircle,\r\n  Instagram,\r\n  Voicemail,\r\n  Wrench\r\n} from \"lucide-react\";\r\nimport { Area, AreaChart, Bar, BarChart, CartesianGrid, XAxis, YAxis, Pie, PieChart, Cell } from \"recharts\";\r\nimport type { NameType, ValueType } from \"recharts/types/component/DefaultTooltipContent\";\r\nimport {\r\n  ChartContainer,\r\n  ChartTooltip,\r\n  ChartTooltipContent,\r\n  type ChartConfig,\r\n} from \"@/components/ui/chart\";\r\nimport { format } from \"date-fns\";\r\nimport { sourceIcons, sourceLabels } from \"./data\";\r\nimport { generatedLeads as leadsData } from \"./leads\";\r\nimport { COLOR_CONFIG } from \"@/lib/constants/themes\";\r\n\r\n// Sample data for charts\r\nconst conversionDataByNumber = [\r\n  { month: \"Aug\", leads: 75, converted: 11 },\r\n  { month: \"Sep\", leads: 82, converted: 13 },\r\n  { month: \"Oct\", leads: 88, converted: 15 },\r\n  { month: \"Nov\", leads: 92, converted: 17 },\r\n  { month: \"Dec\", leads: 87, converted: 16 },\r\n  { month: \"Jan\", leads: 95, converted: 19 },\r\n];\r\n\r\nconst conversionDataByValue = [\r\n  { month: \"Aug\", value: 92500 },\r\n  { month: \"Sep\", value: 109800 },\r\n  { month: \"Oct\", value: 126750 },\r\n  { month: \"Nov\", value: 143650 },\r\n  { month: \"Dec\", value: 135200 },\r\n  { month: \"Jan\", value: 160550 },\r\n];\r\n\r\nconst callActivityData = [\r\n  { time: \"9AM\", calls: 8 },\r\n  { time: \"10AM\", calls: 12 },\r\n  { time: \"11AM\", calls: 15 },\r\n  { time: \"12PM\", calls: 9 },\r\n  { time: \"1PM\", calls: 7 },\r\n  { time: \"2PM\", calls: 11 },\r\n  { time: \"3PM\", calls: 13 },\r\n  { time: \"4PM\", calls: 10 },\r\n  { time: \"5PM\", calls: 6 },\r\n];\r\n\r\nconst teamPerformanceData = [\r\n  { name: \"Emily Rodriguez\", leads: 142, converted: 28, conversion_rate: 19.7, calls_made: 156 },\r\n  { name: \"Michael Chen\", leads: 128, converted: 18, conversion_rate: 14.1, calls_made: 142 },\r\n  { name: \"James Wilson\", leads: 105, converted: 15, conversion_rate: 14.3, calls_made: 118 },\r\n  { name: \"Sarah Thompson\", leads: 89, converted: 12, conversion_rate: 13.5, calls_made: 95 },\r\n];\r\n\r\nconst chartConfig = {\r\n  leads: {\r\n    label: \"Leads\",\r\n    color: \"var(--chart-1)\",\r\n  },\r\n  converted: {\r\n    label: \"Converted\",\r\n    color: \"var(--chart-2)\",\r\n  },\r\n  value: {\r\n    label: \"Value\",\r\n    color: \"var(--chart-3)\",\r\n  },\r\n  calls: {\r\n    label: \"Calls\",\r\n    color: \"var(--chart-4)\",\r\n  },\r\n} satisfies ChartConfig;\r\n\r\nconst getValueNumber = (value: ValueType) => {\r\n  const rawValue = Array.isArray(value) ? value[0] : value;\r\n  return Number(rawValue);\r\n};\r\n\r\nconst formatValueK = (value: ValueType) => `$${(getValueNumber(value) / 1000).toFixed(0)}k`;\r\n\r\ntype WidgetType = \"conversion_number\" | \"conversion_value\" | \"call_activity\" | \"team_performance\" | \"source_distribution\";\r\n\r\ninterface Widget {\r\n  id: string;\r\n  type: WidgetType;\r\n  title: string;\r\n  enabled: boolean;\r\n}\r\n\r\nconst defaultWidgets: Widget[] = [\r\n  { id: \"1\", type: \"conversion_number\", title: \"Lead Conversion (Count)\", enabled: true },\r\n  { id: \"2\", type: \"conversion_value\", title: \"Lead Conversion (Value)\", enabled: true },\r\n  { id: \"3\", type: \"call_activity\", title: \"Call Activity Today\", enabled: true },\r\n  { id: \"4\", type: \"team_performance\", title: \"Team Performance\", enabled: true },\r\n  { id: \"5\", type: \"source_distribution\", title: \"Lead Source Distribution\", enabled: true },\r\n];\r\n\r\nexport default function LeadDashboardPage() {\r\n  const { theme, color } = useTheme();\r\n  const [widgets, setWidgets] = useState<Widget[]>(defaultWidgets);\r\n  const [showWidgetSettings, setShowWidgetSettings] = useState(false);\r\n  const [colors, setColors] = useState(() => {\r\n    // Initialize with current theme color from localStorage\r\n    if (typeof window !== 'undefined') {\r\n      const currentColor = (localStorage.getItem('app-color') || 'pink') as keyof typeof COLOR_CONFIG;\r\n      const baseColor = COLOR_CONFIG[currentColor]?.hex || '#EC4899';\r\n\r\n      const adjustBrightness = (hex: string, percent: number): string => {\r\n        const num = parseInt(hex.replace('#', ''), 16);\r\n        const amt = Math.round(2.55 * percent);\r\n        const R = Math.min(255, (num >> 16) + amt);\r\n        const G = Math.min(255, (num >> 8 & 0x00FF) + amt);\r\n        const B = Math.min(255, (num & 0x0000FF) + amt);\r\n        return '#' + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +\r\n          (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +\r\n          (B < 255 ? B < 1 ? 0 : B : 255))\r\n          .toString(16).slice(1);\r\n      };\r\n\r\n      return {\r\n        chart1: baseColor,\r\n        chart2: adjustBrightness(baseColor, -15),\r\n        chart3: adjustBrightness(baseColor, -30),\r\n        chart4: adjustBrightness(baseColor, 15),\r\n      };\r\n    }\r\n\r\n    // Fallback for SSR\r\n    return {\r\n      chart1: '#EC4899',\r\n      chart2: '#D1397A',\r\n      chart3: '#B62A5B',\r\n      chart4: '#FF5DB8',\r\n    };\r\n  });\r\n  const [dateRange, setDateRange] = useState<{ from: Date; to: Date }>(() => {\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0); // Normalize to start of day\r\n    return { from: today, to: today };\r\n  });\r\n  const [tempDateRange, setTempDateRange] = useState<{ from: Date; to: Date }>(() => {\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0); // Normalize to start of day\r\n    return { from: today, to: today };\r\n  });\r\n  const [isDatePopoverOpen, setIsDatePopoverOpen] = useState(false);\r\n  const [mounted, setMounted] = useState(false);\r\n\r\n  // Prevent hydration mismatch by only rendering after mount\r\n  useEffect(() => {\r\n    setMounted(true);\r\n  }, []);\r\n  const [hoveredCard, setHoveredCard] = useState<string | null>(null);\r\n  const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 });\r\n\r\n  // Helper function to convert hex to oklch (simplified - uses the hex color directly)\r\n  const hexToColor = (hex: string): string => {\r\n    return hex; // Recharts accepts hex colors directly\r\n  };\r\n\r\n  // Helper function to adjust color brightness\r\n  const adjustBrightness = (hex: string, percent: number): string => {\r\n    const num = parseInt(hex.replace('#', ''), 16);\r\n    const amt = Math.round(2.55 * percent);\r\n    const R = Math.min(255, (num >> 16) + amt);\r\n    const G = Math.min(255, (num >> 8 & 0x00FF) + amt);\r\n    const B = Math.min(255, (num & 0x0000FF) + amt);\r\n    return '#' + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +\r\n      (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +\r\n      (B < 255 ? B < 1 ? 0 : B : 255))\r\n      .toString(16).slice(1);\r\n  };\r\n\r\n  // Update chart colors when theme or color changes\r\n  useEffect(() => {\r\n    const updateColors = () => {\r\n      // Re-read color from localStorage to get latest value\r\n      const currentColor = (localStorage.getItem('app-color') || 'pink') as keyof typeof COLOR_CONFIG;\r\n      const baseColor = COLOR_CONFIG[currentColor]?.hex || '#EC4899';\r\n\r\n      // Generate 4 variations of the selected color\r\n      const newColors = {\r\n        chart1: baseColor,\r\n        chart2: adjustBrightness(baseColor, -15), // Darker\r\n        chart3: adjustBrightness(baseColor, -30), // Much darker\r\n        chart4: adjustBrightness(baseColor, 15),  // Lighter\r\n      };\r\n\r\n      setColors(newColors);\r\n    };\r\n\r\n    updateColors();\r\n\r\n    // Listen for custom theme change events\r\n    const handleThemeChange = () => {\r\n      updateColors();\r\n    };\r\n\r\n    // Listen for page visibility changes (in case theme changed in another tab/component)\r\n    const handleVisibilityChange = () => {\r\n      if (document.visibilityState === 'visible') {\r\n        updateColors();\r\n      }\r\n    };\r\n\r\n    window.addEventListener('theme-changed', handleThemeChange);\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n\r\n    // Poll for changes every 500ms as a fallback\r\n    const intervalId = setInterval(updateColors, 500);\r\n\r\n    return () => {\r\n      window.removeEventListener('theme-changed', handleThemeChange);\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n      clearInterval(intervalId);\r\n    };\r\n  }, []); // Empty dependency array - only run on mount and when event fires\r\n\r\n  // Log when date range changes (for debugging/demonstration)\r\n  useEffect(() => {\r\n    // TODO: In production, this would trigger an API call to fetch filtered data\r\n    // For now, the data is static so visual changes won't occur\r\n  }, [dateRange]);\r\n\r\n  const toggleWidget = (widgetId: string) => {\r\n    setWidgets(prev => prev.map(w => w.id === widgetId ? { ...w, enabled: !w.enabled } : w));\r\n  };\r\n\r\n  const handleMouseMove = (e: React.MouseEvent<HTMLDivElement>, cardTitle: string) => {\r\n    const rect = e.currentTarget.getBoundingClientRect();\r\n    const x = ((e.clientX - rect.left) / rect.width) * 100;\r\n    const y = ((e.clientY - rect.top) / rect.height) * 100;\r\n    setMousePosition({ x, y });\r\n    setHoveredCard(cardTitle);\r\n  };\r\n\r\n  const handleMouseLeave = () => {\r\n    setHoveredCard(null);\r\n  };\r\n\r\n  const activeWidgets = widgets.filter(w => w.enabled);\r\n\r\n  // Filter leads data based on selected date range\r\n  const filteredLeads = useMemo(() => {\r\n    return leadsData.filter(lead => {\r\n      const leadDate = new Date(lead.created_at);\r\n      const startDate = new Date(dateRange.from);\r\n      const endDate = new Date(dateRange.to);\r\n\r\n      // Reset time part to compare only dates\r\n      startDate.setHours(0, 0, 0, 0);\r\n      endDate.setHours(23, 59, 59, 999);\r\n\r\n      return leadDate >= startDate && leadDate <= endDate;\r\n    });\r\n  }, [dateRange]);\r\n\r\n  // Calculate stats from filtered leads data\r\n  const totalLeads = filteredLeads.length;\r\n  const convertedLeads = filteredLeads.filter(l => l.status === \"converted\").length;\r\n  const lostLeads = filteredLeads.filter(l => l.status === \"lost\").length;\r\n  const conversionRate = totalLeads > 0 ? ((convertedLeads / totalLeads) * 100).toFixed(1) : \"0.0\";\r\n\r\n  // Calculate number of days in range\r\n  const daysDiff = Math.max(1, Math.ceil((dateRange.to.getTime() - dateRange.from.getTime()) / (1000 * 60 * 60 * 24)) + 1);\r\n\r\n  // Calculate per-day metrics\r\n  const leadsPerDay = (totalLeads / daysDiff).toFixed(1);\r\n  const conversionsPerDay = (convertedLeads / daysDiff).toFixed(1);\r\n  const lostPerDay = (lostLeads / daysDiff).toFixed(1);\r\n\r\n  // Calculate revenue (assuming $8,450 average per converted lead)\r\n  const avgDealValue = 8450;\r\n  const totalRevenue = convertedLeads * avgDealValue;\r\n  const revenuePerDay = (totalRevenue / daysDiff).toFixed(0);\r\n\r\n  const totalCallsMade = 511;\r\n  const avgResponseTime = \"14 min\";\r\n\r\n  // Lead sources stats from filtered data with conversion rates\r\n  const sourceStats = [\r\n    { source: \"website1\", count: filteredLeads.filter(l => l.source === \"website1\").length, converted: filteredLeads.filter(l => l.source === \"website1\" && l.status === \"converted\").length },\r\n    { source: \"website2\", count: filteredLeads.filter(l => l.source === \"website2\").length, converted: filteredLeads.filter(l => l.source === \"website2\" && l.status === \"converted\").length },\r\n    { source: \"trade_site\", count: filteredLeads.filter(l => l.source === \"trade_site\").length, converted: filteredLeads.filter(l => l.source === \"trade_site\" && l.status === \"converted\").length },\r\n    { source: \"inbound_call\", count: filteredLeads.filter(l => l.source === \"inbound_call\").length, converted: filteredLeads.filter(l => l.source === \"inbound_call\" && l.status === \"converted\").length },\r\n    { source: \"voicemail\", count: filteredLeads.filter(l => l.source === \"voicemail\").length, converted: filteredLeads.filter(l => l.source === \"voicemail\" && l.status === \"converted\").length },\r\n    { source: \"email\", count: filteredLeads.filter(l => l.source === \"email\").length, converted: filteredLeads.filter(l => l.source === \"email\" && l.status === \"converted\").length },\r\n    { source: \"facebook_campaign\", count: filteredLeads.filter(l => l.source === \"facebook_campaign\").length, converted: filteredLeads.filter(l => l.source === \"facebook_campaign\" && l.status === \"converted\").length },\r\n    { source: \"facebook_messenger\", count: filteredLeads.filter(l => l.source === \"facebook_messenger\").length, converted: filteredLeads.filter(l => l.source === \"facebook_messenger\" && l.status === \"converted\").length },\r\n    { source: \"instagram\", count: filteredLeads.filter(l => l.source === \"instagram\").length, converted: filteredLeads.filter(l => l.source === \"instagram\" && l.status === \"converted\").length },\r\n    { source: \"whatsapp\", count: filteredLeads.filter(l => l.source === \"whatsapp\").length, converted: filteredLeads.filter(l => l.source === \"whatsapp\" && l.status === \"converted\").length },\r\n  ].map(s => ({\r\n    ...s,\r\n    conversionRate: s.count > 0 ? ((s.converted / s.count) * 100).toFixed(1) : \"0.0\",\r\n    percentage: totalLeads > 0 ? ((s.count / totalLeads) * 100).toFixed(1) : \"0.0\"\r\n  })).sort((a, b) => b.count - a.count);\r\n\r\n  // Team performance data from filtered leads\r\n  const teamStats = [\r\n    { name: \"Emily Rodriguez\", leads: filteredLeads.filter(l => l.assigned_to === \"Emily Rodriguez\").length, converted: filteredLeads.filter(l => l.assigned_to === \"Emily Rodriguez\" && l.status === \"converted\").length },\r\n    { name: \"Michael Chen\", leads: filteredLeads.filter(l => l.assigned_to === \"Michael Chen\").length, converted: filteredLeads.filter(l => l.assigned_to === \"Michael Chen\" && l.status === \"converted\").length },\r\n    { name: \"James Wilson\", leads: filteredLeads.filter(l => l.assigned_to === \"James Wilson\").length, converted: filteredLeads.filter(l => l.assigned_to === \"James Wilson\" && l.status === \"converted\").length },\r\n    { name: \"Sarah Thompson\", leads: filteredLeads.filter(l => l.assigned_to === \"Sarah Thompson\").length, converted: filteredLeads.filter(l => l.assigned_to === \"Sarah Thompson\" && l.status === \"converted\").length },\r\n  ].map(t => ({\r\n    ...t,\r\n    lost: filteredLeads.filter(l => l.assigned_to === t.name && l.status === \"lost\").length,\r\n    conversionRate: t.leads > 0 ? ((t.converted / t.leads) * 100).toFixed(1) : \"0.0\"\r\n  })).sort((a, b) => b.leads - a.leads);\r\n\r\n  const renderWidget = (widget: Widget) => {\r\n    // Create sourceDistributionData dynamically with all lead sources and percentages from FILTERED data\r\n    const allSourceData = [\r\n      { name: sourceLabels.website1 || \"Website 1\", count: filteredLeads.filter(l => l.source === \"website1\").length },\r\n      { name: sourceLabels.website2 || \"Website 2\", count: filteredLeads.filter(l => l.source === \"website2\").length },\r\n      { name: sourceLabels.trade_site || \"Trade Sites\", count: filteredLeads.filter(l => l.source === \"trade_site\").length },\r\n      { name: sourceLabels.inbound_call || \"Inbound Calls\", count: filteredLeads.filter(l => l.source === \"inbound_call\").length },\r\n      { name: sourceLabels.voicemail || \"Voicemail\", count: filteredLeads.filter(l => l.source === \"voicemail\").length },\r\n      { name: sourceLabels.email || \"Email\", count: filteredLeads.filter(l => l.source === \"email\").length },\r\n      { name: sourceLabels.facebook_campaign || \"Facebook Campaign\", count: filteredLeads.filter(l => l.source === \"facebook_campaign\").length },\r\n      { name: sourceLabels.facebook_messenger || \"Facebook Messenger\", count: filteredLeads.filter(l => l.source === \"facebook_messenger\").length },\r\n    ];\r\n\r\n    const totalSources = allSourceData.reduce((sum, item) => sum + item.count, 0);\r\n    const chartColors = [colors.chart1, colors.chart2, colors.chart3, colors.chart4, adjustBrightness(colors.chart1, 10), adjustBrightness(colors.chart2, 10), adjustBrightness(colors.chart3, 10), adjustBrightness(colors.chart4, 10)];\r\n\r\n    const sourceDistributionData = allSourceData.map((item, index) => ({\r\n      name: item.name,\r\n      value: item.count,\r\n      percentage: totalSources > 0 ? ((item.count / totalSources) * 100).toFixed(1) : \"0\",\r\n      fill: chartColors[index % chartColors.length],\r\n    })).filter(item => item.value > 0) // Only show sources with leads\r\n      .sort((a, b) => b.value - a.value) // Sort by count descending\r\n      .slice(0, 6); // Show top 6 sources only\r\n\r\n    // Custom label renderer for pie chart\r\n    const renderCustomLabel = (entry: any) => {\r\n      return `${entry.name}\\n${entry.value} (${entry.percentage}%)`;\r\n    };\r\n\r\n    switch (widget.type) {\r\n      case \"conversion_number\":\r\n        return (\r\n          <Card key={`widget-${widget.id}-${colors.chart1}-${colors.chart2}`}>\r\n            <CardHeader>\r\n              <CardTitle>Lead Conversion by Count</CardTitle>\r\n              <CardDescription>Leads vs conversions</CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <ChartContainer config={chartConfig} className=\"h-[200px] w-full\" key={`leads-area-${colors.chart1}-${colors.chart2}`}>\r\n                <AreaChart data={conversionDataByNumber}>\r\n                  <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\r\n                  <XAxis dataKey=\"month\" tickLine={false} axisLine={false} className=\"text-muted-foreground\" />\r\n                  <YAxis tickLine={false} axisLine={false} className=\"text-muted-foreground\" />\r\n                  <ChartTooltip content={<ChartTooltipContent />} />\r\n                  <Area type=\"monotone\" dataKey=\"leads\" stroke={colors.chart1} fill={colors.chart1} fillOpacity={0.3} label={{ position: 'top' }} />\r\n                  <Area type=\"monotone\" dataKey=\"converted\" stroke={colors.chart2} fill={colors.chart2} fillOpacity={0.15} label={{ position: 'top' }} />\r\n                </AreaChart>\r\n              </ChartContainer>\r\n            </CardContent>\r\n          </Card>\r\n        );\r\n\r\n      case \"conversion_value\":\r\n        return (\r\n          <Card key={`widget-${widget.id}-${colors.chart3}`}>\r\n            <CardHeader>\r\n              <CardTitle>Revenue Trend</CardTitle>\r\n              <CardDescription>Monthly revenue from conversions</CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <ChartContainer config={chartConfig} className=\"h-[200px] w-full\" key={`value-bar-${colors.chart3}`}>\r\n                <BarChart data={conversionDataByValue}>\r\n                  <CartesianGrid strokeDasharray=\"3 3\" />\r\n                  <XAxis dataKey=\"month\" tickLine={false} axisLine={false} />\r\n                  <YAxis tickLine={false} axisLine={false} tickFormatter={formatValueK} />\r\n                  <ChartTooltip content={<ChartTooltipContent formatter={(value: ValueType) => `$${getValueNumber(value).toLocaleString()}`} />} />\r\n                  <Bar dataKey=\"value\" fill={colors.chart3} radius={[4, 4, 0, 0]} label={{ position: 'top', formatter: (value: any) => `$${(value / 1000).toFixed(0)}k` }} />\r\n                </BarChart>\r\n              </ChartContainer>\r\n            </CardContent>\r\n          </Card>\r\n        );\r\n\r\n      case \"call_activity\":\r\n        return (\r\n          <Card key={widget.id}>\r\n            <CardHeader>\r\n              <CardTitle>Call Activity Today</CardTitle>\r\n              <CardDescription>Calls made by hour</CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <ChartContainer config={chartConfig} className=\"h-[200px] w-full\" key={`calls-bar-${colors.chart4}`}>\r\n                <BarChart data={callActivityData}>\r\n                  <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\r\n                  <XAxis dataKey=\"time\" tickLine={false} axisLine={false} className=\"text-muted-foreground\" />\r\n                  <YAxis tickLine={false} axisLine={false} className=\"text-muted-foreground\" />\r\n                  <ChartTooltip content={<ChartTooltipContent />} />\r\n                  <Bar dataKey=\"calls\" fill={colors.chart4} radius={[4, 4, 0, 0]} label={{ position: 'top' }} />\r\n                </BarChart>\r\n              </ChartContainer>\r\n            </CardContent>\r\n          </Card>\r\n        );\r\n\r\n      case \"team_performance\":\r\n        return (\r\n          <Card key={widget.id}>\r\n            <CardHeader>\r\n              <CardTitle>Team Performance</CardTitle>\r\n              <CardDescription>Individual rep metrics and leaderboard</CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-3\">\r\n                {teamPerformanceData.map((member, index) => (\r\n                  <div key={member.name} className=\"flex items-center gap-4 p-4 border rounded-lg\">\r\n                    <div className=\"flex items-center justify-center h-10 w-10 rounded-full bg-primary/10 text-primary font-semibold\">\r\n                      #{index + 1}\r\n                    </div>\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center justify-between mb-2\">\r\n                        <p className=\"font-semibold\">{member.name}</p>\r\n                        {index === 0 && <Award className=\"h-5 w-5 text-yellow-500\" />}\r\n                      </div>\r\n                      <div className=\"grid grid-cols-4 gap-4 text-sm\">\r\n                        <div>\r\n                          <p className=\"text-muted-foreground text-xs\">Leads</p>\r\n                          <p className=\"font-semibold\">{member.leads}</p>\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"text-muted-foreground text-xs\">Converted</p>\r\n                          <p className=\"font-semibold text-green-600\">{member.converted}</p>\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"text-muted-foreground text-xs\">Conv. Rate</p>\r\n                          <p className=\"font-semibold\">{member.conversion_rate}%</p>\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"text-muted-foreground text-xs\">Calls Made</p>\r\n                          <p className=\"font-semibold\">{member.calls_made}</p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        );\r\n\r\n      case \"source_distribution\":\r\n        return (\r\n          <Card key={widget.id}>\r\n            <CardHeader>\r\n              <CardTitle>Source Performance</CardTitle>\r\n              <CardDescription>Visual breakdown of lead channels</CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <ChartContainer config={chartConfig} className=\"h-80 w-full flex items-center justify-center\" key={`pie-${colors.chart1}-${colors.chart2}`}>\r\n                <PieChart width={400} height={320}>\r\n                  <Pie\r\n                    data={sourceDistributionData}\r\n                    dataKey=\"value\"\r\n                    nameKey=\"name\"\r\n                    cx=\"50%\"\r\n                    cy=\"50%\"\r\n                    outerRadius={100}\r\n                    label={renderCustomLabel}\r\n                    labelLine={false}\r\n                  >\r\n                    {sourceDistributionData.map((entry, index) => (\r\n                      <Cell key={`cell-${index}`} fill={entry.fill} />\r\n                    ))}\r\n                  </Pie>\r\n                  <ChartTooltip content={<ChartTooltipContent formatter={(value: ValueType, name: NameType) => {\r\n                    const displayName = String(name);\r\n                    const percentage = sourceDistributionData.find(d => d.name === displayName)?.percentage;\r\n                    return [`${getValueNumber(value)} leads (${percentage ?? 0}%)`, displayName];\r\n                  }} />} />\r\n                </PieChart>\r\n              </ChartContainer>\r\n            </CardContent>\r\n          </Card>\r\n        );\r\n\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  // Prevent hydration mismatch for date-dependent content\r\n  if (!mounted) {\r\n    return (\r\n      <div className=\"p-4 md:p-6 flex items-center justify-center h-96\">\r\n        <div className=\"animate-pulse\">Loading...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-8\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex flex-col gap-1\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <Users className=\"h-8 w-8 text-primary\" />\r\n            <h1 className=\"text-2xl font-bold tracking-tight\">Lead Dashboard</h1>\r\n          </div>\r\n          <p className=\"text-sm font-normal text-muted-foreground mt-1\">\r\n            Performance metrics, conversion tracking, and team analytics\r\n          </p>\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <Button variant=\"outline\" className=\"gap-2\" onClick={() => setShowWidgetSettings(!showWidgetSettings)}>\r\n            <Settings2 className=\"h-4 w-4\" />\r\n            Customize Widgets\r\n          </Button>\r\n          <Popover open={isDatePopoverOpen} onOpenChange={setIsDatePopoverOpen}>\r\n            <PopoverTrigger asChild>\r\n              <Button variant=\"outline\" className=\"min-w-[200px] font-normal\">\r\n                <CalendarIcon className=\"h-4 w-4 mr-2\" />\r\n                {dateRange?.from ? (\r\n                  dateRange.to ? (\r\n                    <>\r\n                      {format(dateRange.from, \"MMM dd, yyyy\")} - {format(dateRange.to, \"MMM dd, yyyy\")}\r\n                    </>\r\n                  ) : (\r\n                    format(dateRange.from, \"MMM dd, yyyy\")\r\n                  )\r\n                ) : (\r\n                  <span>Pick a date range</span>\r\n                )}\r\n              </Button>\r\n            </PopoverTrigger>\r\n            <PopoverContent className=\"w-auto p-0\" align=\"end\">\r\n              <div className=\"flex flex-wrap justify-end gap-2 p-2 border-b\">\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  onClick={() => {\r\n                    const today = new Date();\r\n                    setTempDateRange({ from: today, to: today });\r\n                  }}\r\n                >\r\n                  Today\r\n                </Button>\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  onClick={() => {\r\n                    const today = new Date();\r\n                    const weekAgo = new Date(today);\r\n                    weekAgo.setDate(weekAgo.getDate() - 7);\r\n                    setTempDateRange({ from: weekAgo, to: today });\r\n                  }}\r\n                >\r\n                  Last 7 Days\r\n                </Button>\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  onClick={() => {\r\n                    const today = new Date();\r\n                    const monthAgo = new Date(today);\r\n                    monthAgo.setMonth(monthAgo.getMonth() - 1);\r\n                    setTempDateRange({ from: monthAgo, to: today });\r\n                  }}\r\n                >\r\n                  Last 30 Days\r\n                </Button>\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  onClick={() => {\r\n                    const today = new Date();\r\n                    const sixMonthsAgo = new Date(today);\r\n                    sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);\r\n                    setTempDateRange({ from: sixMonthsAgo, to: today });\r\n                  }}\r\n                >\r\n                  Last 6 Months\r\n                </Button>\r\n              </div>\r\n              <Calendar\r\n                mode=\"range\"\r\n                defaultMonth={tempDateRange?.from}\r\n                selected={{ from: tempDateRange?.from, to: tempDateRange?.to }}\r\n                onSelect={(range) => {\r\n                  if (range?.from && range?.to) {\r\n                    setTempDateRange({ from: range.from, to: range.to });\r\n                  }\r\n                }}\r\n                numberOfMonths={2}\r\n              />\r\n              <div className=\"flex justify-end gap-2 p-2 border-t\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  onClick={() => {\r\n                    setTempDateRange(dateRange);\r\n                    setIsDatePopoverOpen(false);\r\n                  }}\r\n                >\r\n                  Cancel\r\n                </Button>\r\n                <Button\r\n                  size=\"sm\"\r\n                  onClick={() => {\r\n                    setDateRange(tempDateRange);\r\n                    setIsDatePopoverOpen(false);\r\n                  }}\r\n                >\r\n                  Apply\r\n                </Button>\r\n              </div>\r\n            </PopoverContent>\r\n          </Popover>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Widget Settings Panel */}\r\n      {showWidgetSettings && (\r\n        <Card className=\"bg-muted/50\">\r\n          <CardHeader>\r\n            <CardTitle className=\"text-lg\">Widget Settings</CardTitle>\r\n            <CardDescription>Enable or disable widgets to customize your dashboard</CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3\">\r\n              {widgets.map(widget => (\r\n                <Button\r\n                  key={widget.id}\r\n                  variant={widget.enabled ? \"default\" : \"outline\"}\r\n                  className=\"h-auto py-3 flex flex-col items-center gap-2\"\r\n                  onClick={() => toggleWidget(widget.id)}\r\n                >\r\n                  <span className=\"text-sm text-center\">{widget.title}</span>\r\n                  <span className=\"text-xs opacity-70\">{widget.enabled ? \"Enabled\" : \"Disabled\"}</span>\r\n                </Button>\r\n              ))}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* KPI Cards */}\r\n      <div className=\"grid gap-6 sm:grid-cols-2 lg:grid-cols-4\">\r\n        {/* Total Leads */}\r\n        <Card\r\n          key={`kpi-leads-${colors.chart1}`}\r\n          className=\"overflow-hidden transition-all duration-300 hover:shadow-lg relative\"\r\n          onMouseMove={(e) => handleMouseMove(e, \"Total Leads\")}\r\n          onMouseLeave={handleMouseLeave}\r\n          style={{\r\n            ...(hoveredCard === \"Total Leads\" && {\r\n              background: `radial-gradient(circle 600px at ${mousePosition.x}% ${mousePosition.y}%, var(--muted) 0%, var(--card) 50%, var(--muted) 100%)`,\r\n            })\r\n          }}\r\n        >\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-3\">\r\n            <CardTitle className=\"text-sm font-medium\">Total Leads</CardTitle>\r\n            <div className=\"h-10 w-10 rounded-lg flex items-center justify-center bg-primary/10\">\r\n              <Users className=\"h-5 w-5 text-primary\" />\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-2\">\r\n            <div className=\"text-3xl font-bold\">{totalLeads}</div>\r\n            <p className=\"text-xs text-muted-foreground mt-1\">\r\n              <span className=\"flex items-center gap-1 text-primary\">\r\n                <TrendingUp className=\"h-3 w-3\" />\r\n                {leadsPerDay} average leads per day\r\n              </span>\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Total Conversions */}\r\n        <Card\r\n          key={`kpi-conversions-${colors.chart1}`}\r\n          className=\"overflow-hidden transition-all duration-300 hover:shadow-lg relative\"\r\n          onMouseMove={(e) => handleMouseMove(e, \"Total Conversions\")}\r\n          onMouseLeave={handleMouseLeave}\r\n          style={{\r\n            ...(hoveredCard === \"Total Conversions\" && {\r\n              background: `radial-gradient(circle 600px at ${mousePosition.x}% ${mousePosition.y}%, var(--muted) 0%, var(--card) 50%, var(--muted) 100%)`,\r\n            })\r\n          }}\r\n        >\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-3\">\r\n            <CardTitle className=\"text-sm font-medium\">Total Conversions</CardTitle>\r\n            <div className=\"h-10 w-10 rounded-lg flex items-center justify-center bg-primary/10\">\r\n              <CheckCircle2 className=\"h-5 w-5 text-primary\" />\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-2\">\r\n            <div className=\"text-3xl font-bold\">{convertedLeads}</div>\r\n            <p className=\"text-xs text-muted-foreground mt-1\">\r\n              <span className=\"flex items-center gap-1 text-primary\">\r\n                <TrendingUp className=\"h-3 w-3\" />\r\n                {conversionsPerDay} average conversions per day\r\n              </span>\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Total Revenue */}\r\n        <Card\r\n          key={`kpi-revenue-${colors.chart1}`}\r\n          className=\"overflow-hidden transition-all duration-300 hover:shadow-lg relative\"\r\n          onMouseMove={(e) => handleMouseMove(e, \"Total Revenue\")}\r\n          onMouseLeave={handleMouseLeave}\r\n          style={{\r\n            ...(hoveredCard === \"Total Revenue\" && {\r\n              background: `radial-gradient(circle 600px at ${mousePosition.x}% ${mousePosition.y}%, var(--muted) 0%, var(--card) 50%, var(--muted) 100%)`,\r\n            })\r\n          }}\r\n        >\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-3\">\r\n            <CardTitle className=\"text-sm font-medium\">Total Revenue</CardTitle>\r\n            <div className=\"h-10 w-10 rounded-lg flex items-center justify-center bg-primary/10\">\r\n              <DollarSign className=\"h-5 w-5 text-primary\" />\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-2\">\r\n            <div className=\"text-3xl font-bold\">${(totalRevenue / 1000).toFixed(0)}k</div>\r\n            <p className=\"text-xs text-muted-foreground mt-1\">\r\n              <span className=\"flex items-center gap-1 text-primary\">\r\n                <TrendingUp className=\"h-3 w-3\" />\r\n                average ${(Number(revenuePerDay) / 1000).toFixed(1)}k per day\r\n              </span>\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Total Lost */}\r\n        <Card\r\n          key={`kpi-lost-${colors.chart1}`}\r\n          className=\"overflow-hidden transition-all duration-300 hover:shadow-lg relative\"\r\n          onMouseMove={(e) => handleMouseMove(e, \"Total Lost\")}\r\n          onMouseLeave={handleMouseLeave}\r\n          style={{\r\n            ...(hoveredCard === \"Total Lost\" && {\r\n              background: `radial-gradient(circle 600px at ${mousePosition.x}% ${mousePosition.y}%, var(--muted) 0%, var(--card) 50%, var(--muted) 100%)`,\r\n            })\r\n          }}\r\n        >\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-3\">\r\n            <CardTitle className=\"text-sm font-medium\">Total Lost</CardTitle>\r\n            <div className=\"h-10 w-10 rounded-lg flex items-center justify-center bg-red-500/10\">\r\n              <X className=\"h-5 w-5 text-red-500\" />\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-2\">\r\n            <div className=\"text-3xl font-bold\">{lostLeads}</div>\r\n            <p className=\"text-xs text-muted-foreground mt-1\">\r\n              <span className=\"flex items-center gap-1 text-red-500\">\r\n                <TrendingDown className=\"h-3 w-3\" />\r\n                {lostPerDay} average lost per day\r\n              </span>\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* COLLAPSIBLE CATEGORIES */}\r\n      <Accordion type=\"multiple\" defaultValue={[\"performance\", \"team\", \"sources\", \"activity\"]} className=\"space-y-4\">\r\n        {/* PERFORMANCE METRICS CATEGORY */}\r\n        <AccordionItem value=\"performance\" className=\"border rounded-lg px-6\">\r\n          <AccordionTrigger className=\"hover:no-underline py-4\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"h-8 w-1 bg-primary rounded-full\" />\r\n              <h2 className=\"text-2xl font-bold\">Performance Metrics</h2>\r\n            </div>\r\n          </AccordionTrigger>\r\n          <AccordionContent className=\"pb-6\">\r\n            <div className=\"grid gap-4 lg:grid-cols-2 pt-2\">\r\n              {activeWidgets.filter(w => w.type === \"conversion_number\" || w.type === \"conversion_value\").map(widget => renderWidget(widget))}\r\n            </div>\r\n          </AccordionContent>\r\n        </AccordionItem>\r\n\r\n        {/* TEAM PERFORMANCE CATEGORY */}\r\n        <AccordionItem value=\"team\" className=\"border rounded-lg px-6\">\r\n          <AccordionTrigger className=\"hover:no-underline py-4\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"h-8 w-1 bg-primary rounded-full\" />\r\n              <h2 className=\"text-2xl font-bold\">Team Performance</h2>\r\n            </div>\r\n          </AccordionTrigger>\r\n          <AccordionContent className=\"pb-6\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Leads per Sales Person</CardTitle>\r\n                <CardDescription>Lead distribution and conversion performance by team member</CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-6\">\r\n                  {teamStats.map((member, index) => {\r\n                    const maxLeads = Math.max(...teamStats.map(t => t.leads));\r\n                    const barWidth = (member.leads / maxLeads) * 100;\r\n                    const convertedWidth = member.leads > 0 ? (member.converted / member.leads) * 100 : 0;\r\n                    const lostWidth = member.leads > 0 ? (member.lost / member.leads) * 100 : 0;\r\n\r\n                    return (\r\n                      <div key={member.name} className=\"space-y-2\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <div className=\"flex items-center justify-center h-8 w-8 rounded-full bg-primary/10 text-primary font-semibold text-sm\">\r\n                              #{index + 1}\r\n                            </div>\r\n                            <div>\r\n                              <p className=\"font-semibold flex items-center gap-2\">\r\n                                {member.name}\r\n                                {index === 0 && <Award className=\"h-4 w-4 text-yellow-500\" />}\r\n                              </p>\r\n                              <p className=\"text-xs text-muted-foreground\">\r\n                                {member.leads} leads  {member.converted} converted  {member.conversionRate}% rate\r\n                              </p>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"relative h-8 bg-muted rounded-lg overflow-hidden\">\r\n                          <div\r\n                            className=\"absolute left-0 top-0 h-full bg-primary/20 transition-all duration-500\"\r\n                            style={{ width: `${barWidth}%` }}\r\n                          />\r\n                          <div\r\n                            className=\"absolute left-0 top-0 h-full bg-primary transition-all duration-500\"\r\n                            style={{ width: `${(member.converted / maxLeads) * 100}%` }}\r\n                          />\r\n                          <div className=\"absolute inset-0 flex items-center justify-between px-3\">\r\n                            <span className=\"text-xs font-semibold text-primary-foreground drop-shadow-sm\">\r\n                              {member.converted} converted\r\n                            </span>\r\n                            <span className=\"text-xs font-medium\">\r\n                              {member.leads} total\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </AccordionContent>\r\n        </AccordionItem>\r\n\r\n        {/* LEAD SOURCES CATEGORY */}\r\n        <AccordionItem value=\"sources\" className=\"border rounded-lg px-6\">\r\n          <AccordionTrigger className=\"hover:no-underline py-4\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"h-8 w-1 bg-primary rounded-full\" />\r\n              <h2 className=\"text-2xl font-bold\">Lead Sources</h2>\r\n            </div>\r\n          </AccordionTrigger>\r\n          <AccordionContent className=\"pb-6\">\r\n            <div className=\"grid gap-4 lg:grid-cols-2 pt-2\">\r\n              {/* Lead Sources Bar Chart */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle>Source Distribution</CardTitle>\r\n                  <CardDescription>Lead volume and conversion rate by channel</CardDescription>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"space-y-4\">\r\n                    {sourceStats.slice(0, 8).map((stat) => {\r\n                      const Icon = sourceIcons[stat.source as keyof typeof sourceIcons];\r\n                      const maxCount = Math.max(...sourceStats.map(s => s.count));\r\n                      const barWidth = stat.count > 0 ? (stat.count / maxCount) * 100 : 0;\r\n\r\n                      return (\r\n                        <div key={stat.source} className=\"space-y-1\">\r\n                          <div className=\"flex items-center justify-between text-sm\">\r\n                            <div className=\"flex items-center gap-2 flex-1\">\r\n                              <Icon className=\"h-4 w-4 text-primary\" />\r\n                              <span className=\"font-medium\">{sourceLabels[stat.source as keyof typeof sourceLabels]}</span>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-3 text-xs text-muted-foreground\">\r\n                              <span>{stat.count} leads</span>\r\n                              <span className=\"text-primary font-semibold\">{stat.conversionRate}%</span>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"relative h-6 bg-muted rounded-md overflow-hidden\">\r\n                            <div\r\n                              className=\"absolute left-0 top-0 h-full bg-primary/20 transition-all duration-500\"\r\n                              style={{ width: `${barWidth}%` }}\r\n                            />\r\n                            <div\r\n                              className=\"absolute left-0 top-0 h-full bg-primary transition-all duration-500\"\r\n                              style={{ width: `${(stat.converted / maxCount) * 100}%` }}\r\n                            />\r\n                            <div className=\"absolute inset-0 flex items-center px-2\">\r\n                              <span className=\"text-xs font-semibold text-primary-foreground drop-shadow-sm\">\r\n                                {stat.percentage}%\r\n                              </span>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/* Source Distribution Pie Chart */}\r\n              {activeWidgets.filter(w => w.type === \"source_distribution\").map(widget => renderWidget(widget))}\r\n            </div>\r\n          </AccordionContent>\r\n        </AccordionItem>\r\n\r\n        {/* ACTIVITY & INSIGHTS CATEGORY */}\r\n        <AccordionItem value=\"activity\" className=\"border rounded-lg px-6 pb-0\">\r\n          <AccordionTrigger className=\"hover:no-underline py-4\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"h-8 w-1 bg-primary rounded-full\" />\r\n              <h2 className=\"text-2xl font-bold\">Activity & Insights</h2>\r\n            </div>\r\n          </AccordionTrigger>\r\n          <AccordionContent className=\"pb-6\">\r\n            <div className=\"grid gap-4 lg:grid-cols-2 pt-2\">\r\n              {activeWidgets.filter(w => w.type === \"call_activity\").map(widget => renderWidget(widget))}\r\n              {activeWidgets.filter(w => w.type === \"team_performance\").map(widget => renderWidget(widget))}\r\n            </div>\r\n          </AccordionContent>\r\n        </AccordionItem>\r\n      </Accordion>\r\n\r\n      {/* QUICK ACTIONS */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Quick Actions</CardTitle>\r\n          <CardDescription>Common lead management tasks</CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-3\">\r\n            <Link href=\"/dashboard/leads/all\">\r\n              <Button variant=\"outline\" className=\"w-full gap-2\">\r\n                <Users className=\"h-4 w-4\" />\r\n                View All Leads\r\n              </Button>\r\n            </Link>\r\n            <Link href=\"/dashboard/leads/add\">\r\n              <Button variant=\"outline\" className=\"w-full gap-2\">\r\n                <Plus className=\"h-4 w-4\" />\r\n                Add New Lead\r\n              </Button>\r\n            </Link>\r\n            <Link href=\"/dashboard/leads/round-robin\">\r\n              <Button variant=\"outline\" className=\"w-full gap-2\">\r\n                <Zap className=\"h-4 w-4\" />\r\n                Round Robin\r\n              </Button>\r\n            </Link>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]}]
